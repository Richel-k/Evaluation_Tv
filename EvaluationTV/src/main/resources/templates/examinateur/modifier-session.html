<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier une Session</title>
    <link rel="stylesheet" th:href="@{/css/Home.css}">
</head>

<body>
    <!-- Menu Toggle -->
    <button class="menu-toggle" onclick="toggleSidebar()">
        <span class="hamburger-icon">‚ò∞</span>
    </button>

    <!-- Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar examinateur-sidebar" id="sidebar">
        <h2>üë®‚Äçüè´ Examinateur</h2>
        <a th:href="@{/examinateur/dashboard}">üè† Dashboard</a>
        <a th:href="@{/examinateur/update-session}">üìù Mes Sessions</a>
        <a th:href="@{/examinateur/create-session}">‚ûï Cr√©er Session</a>
        <!-- <a class="active" th:href="@{/examinateur/modifier-session}">‚úèÔ∏è Modifier Session</a> -->
        <a href="/logout" class="logout">üö™ D√©connexion</a>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="content-wrapper">
            <!-- Header avec recherche -->
            <div class="page-header">
                <h1 class="page-title">‚úèÔ∏è Modifier une Session</h1>
                <p class="page-subtitle">Modifiez ou mettez √† jour une session existante</p>

                <div class="search-container">
                    <div class="input-group">
                        <input type="text" id="search-session" placeholder="Rechercher par titre, ID ou code..."
                            onkeyup="searchSessions()">
                        <button onclick="loadSessionDetails()">üîç Rechercher</button>
                    </div>
                </div>
            </div>

            <!-- Sessions disponibles -->
            <div class="sessions-list-section">
                <h3>üìã Mes Sessions Disponibles</h3>
                <div class="sessions-grid" id="sessions-grid">
                    <!-- Les sessions seront charg√©es ici dynamiquement -->
                </div>
            </div>

            <!-- Form de modification (cach√© par d√©faut) -->
            <div class="form-container" id="edit-form" style="display: none;">
                <!-- En-t√™te avec infos session -->
                <div class="session-info-header">
                    <div class="session-badge">
                        <span class="session-code" id="edit-session-code">SESSION-2024-001</span>
                        <span class="session-status status-active" id="edit-session-status">En cours</span>
                    </div>
                    <h2 id="edit-session-title">Examen de Programmation Java</h2>
                    <div class="session-meta" id="edit-session-meta">
                        <span>üìÖ 15 D√©c 2024 √† 14:00</span>
                        <span>‚è∞ Dur√©e: 60 min</span>
                        <span>üë• 45 candidats inscrits</span>
                    </div>
                </div>

                <!-- Informations de Base -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3>üìã Modifier les Informations</h3>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit-title">Titre de la Session</label>
                            <input type="text" id="edit-title" value="Examen de Programmation Java">
                        </div>

                        <div class="form-group">
                            <label for="edit-description">Description</label>
                            <textarea id="edit-description" rows="2">Examen sur les concepts avanc√©s de Java</textarea>
                        </div>

                        <div class="form-group">
                            <label for="edit-date">Date de la Session</label>
                            <input type="date" id="edit-date" value="2024-12-15">
                        </div>

                        <div class="form-group">
                            <label for="edit-time">Heure de D√©but</label>
                            <input type="time" id="edit-time" value="14:00">
                        </div>

                        <div class="form-group">
                            <label for="edit-duration">Dur√©e (minutes)</label>
                            <input type="number" id="edit-duration" value="60" min="1">
                        </div>

                        <div class="form-group">
                            <label for="edit-max-candidates">Candidats maximum</label>
                            <input type="number" id="edit-max-candidates" value="50" min="1">
                        </div>
                    </div>
                </div>

                <!-- Gestion des Participants -->
                <div class="form-section">
                    <div class="form-section-header">
                        <div class="header-with-action">
                            <h3>üë• Gestion des Participants</h3>
                            <button type="button" class="btn-primary btn-small" onclick="exportParticipants()">
                                üì• Exporter la liste
                            </button>
                        </div>
                    </div>

                    <div class="participants-table">
                        <div class="table-header">
                            <div class="col-name">Nom du Candidat</div>
                            <div class="col-email">Email</div>
                            <div class="col-status">Statut</div>
                            <div class="col-actions">Actions</div>
                        </div>

                        <div class="table-body">
                            <div class="table-row">
                                <div class="col-name">Marie Martin</div>
                                <div class="col-email">marie.martin@etudiant.fr</div>
                                <div class="col-status">
                                    <span class="status-badge status-active">Inscrit</span>
                                </div>
                                <div class="col-actions">
                                    <button class="btn-danger btn-tiny" onclick="removeParticipant(1)">Retirer</button>
                                </div>
                            </div>
                            <div class="table-row">
                                <div class="col-name">Thomas Bernard</div>
                                <div class="col-email">thomas.bernard@etudiant.fr</div>
                                <div class="col-status">
                                    <span class="status-badge status-completed">Termin√©</span>
                                </div>
                                <div class="col-actions">
                                    <button class="btn-primary btn-tiny" onclick="viewResults(1)">R√©sultats</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="add-participant">
                        <div class="input-group">
                            <input type="email" id="new-participant" placeholder="Email du candidat √† ajouter...">
                            <button onclick="addParticipant()">‚ûï Ajouter</button>
                        </div>
                        <small>Vous pouvez aussi importer une liste via CSV</small>
                    </div>
                </div>

                <!-- Questions de la Session -->
                <div class="form-section">
                    <div class="form-section-header">
                        <div class="header-with-action">
                            <h3>‚ùì Questions de la Session</h3>
                            <button type="button" class="btn-primary btn-small" onclick="addQuestionToSession()">
                                ‚ûï Ajouter Question
                            </button>
                        </div>
                    </div>

                    <div class="questions-summary">
                        <div class="summary-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="total-questions">8</div>
                                <div class="stat-label">Questions</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="total-points">20</div>
                                <div class="stat-label">Points totaux</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="avg-difficulty">Moyenne</div>
                                <div class="stat-label">Difficult√©</div>
                            </div>
                        </div>

                        <div class="questions-list" id="session-questions">
                            <!-- Questions seront charg√©es ici -->
                        </div>
                    </div>
                </div>

                <!-- Actions de Modification -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3>‚öôÔ∏è Actions de Session</h3>
                    </div>

                    <div class="action-buttons-grid">
                        <button type="button" class="action-btn" onclick="duplicateSession()">
                            <div class="action-icon">üìã</div>
                            <div class="action-content">
                                <div class="action-title">Dupliquer la Session</div>
                                <div class="action-desc">Cr√©er une copie avec de nouveaux param√®tres</div>
                            </div>
                        </button>

                        <button type="button" class="action-btn" onclick="exportSession()">
                            <div class="action-icon">üì§</div>
                            <div class="action-content">
                                <div class="action-title">Exporter la Session</div>
                                <div class="action-desc">T√©l√©charger en format JSON ou CSV</div>
                            </div>
                        </button>

                        <button type="button" class="action-btn btn-danger" onclick="archiveSession()">
                            <div class="action-icon">üóÑÔ∏è</div>
                            <div class="action-content">
                                <div class="action-title">Archiver la Session</div>
                                <div class="action-desc">D√©sactiver sans suppression d√©finitive</div>
                            </div>
                        </button>

                        <button type="button" class="action-btn btn-danger" onclick="deleteSession()">
                            <div class="action-icon">üóëÔ∏è</div>
                            <div class="action-content">
                                <div class="action-title">Supprimer D√©finitivement</div>
                                <div class="action-desc">Attention : action irr√©versible</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="cancelEdit()">
                        ‚Üê Annuler
                    </button>
                    <button type="button" class="btn-danger" onclick="resetChanges()">
                        üîÑ Annuler modifications
                    </button>
                    <button type="button" class="btn-primary" onclick="saveChanges()">
                        üíæ Sauvegarder les modifications
                    </button>
                    <button type="button" class="btn-primary" onclick="publishChanges()">
                        üåê Publier les modifications
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es de test
        const sessions = [
            {
                id: 1,
                code: "SESSION-2024-001",
                title: "Examen de Programmation Java",
                date: "2024-12-15",
                time: "14:00",
                duration: 60,
                candidates: 45,
                status: "active",
                questions: 8
            },
            {
                id: 2,
                code: "SESSION-2024-002",
                title: "Test Base de Donn√©es SQL",
                date: "2024-12-20",
                time: "10:00",
                duration: 90,
                candidates: 38,
                status: "planned",
                questions: 15
            },
            {
                id: 3,
                code: "SESSION-2024-003",
                title: "Examen Algorithmique",
                date: "2024-12-05",
                time: "09:00",
                duration: 120,
                candidates: 52,
                status: "ended",
                questions: 18
            }
        ];

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function loadSessions() {
            const grid = document.getElementById('sessions-grid');
            grid.innerHTML = '';

            sessions.forEach(session => {
                const sessionHTML = `
                    <div class="session-card" onclick="loadSession(${session.id})">
                        <div class="session-card-header">
                            <span class="session-card-code">${session.code}</span>
                            <span class="session-status status-${session.status}">
                                ${session.status === 'active' ? 'En cours' :
                        session.status === 'planned' ? 'Planifi√©e' : 'Termin√©e'}
                            </span>
                        </div>
                        <h4 class="session-card-title">${session.title}</h4>
                        <div class="session-card-meta">
                            <span>üìÖ ${session.date}</span>
                            <span>‚è∞ ${session.time}</span>
                            <span>üë• ${session.candidates} candidats</span>
                            <span>‚ùì ${session.questions} questions</span>
                        </div>
                        <div class="session-card-actions">
                            <button class="btn-primary btn-small" onclick="event.stopPropagation(); loadSession(${session.id})">
                                Modifier
                            </button>
                        </div>
                    </div>
                `;
                grid.innerHTML += sessionHTML;
            });
        }

        function loadSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;

            // Afficher le formulaire
            document.getElementById('edit-form').style.display = 'block';

            // Remplir les champs
            document.getElementById('edit-session-code').textContent = session.code;
            document.getElementById('edit-session-status').textContent =
                session.status === 'active' ? 'En cours' :
                    session.status === 'planned' ? 'Planifi√©e' : 'Termin√©e';
            document.getElementById('edit-session-title').textContent = session.title;
            document.getElementById('edit-title').value = session.title;
            document.getElementById('edit-date').value = session.date;
            document.getElementById('edit-time').value = session.time;
            document.getElementById('edit-duration').value = session.duration;
            document.getElementById('edit-max-candidates').value = session.candidates;

            // Mettre √† jour les m√©tadonn√©es
            document.getElementById('edit-session-meta').innerHTML = `
                <span>üìÖ ${session.date} √† ${session.time}</span>
                <span>‚è∞ Dur√©e: ${session.duration} min</span>
                <span>üë• ${session.candidates} candidats inscrits</span>
            `;

            // Faire d√©filer vers le formulaire
            document.getElementById('edit-form').scrollIntoView({ behavior: 'smooth' });
        }

        function loadSessionDetails() {
            const search = document.getElementById('search-session').value.toLowerCase();
            if (search) {
                const foundSession = sessions.find(s =>
                    s.title.toLowerCase().includes(search) ||
                    s.code.toLowerCase().includes(search)
                );

                if (foundSession) {
                    loadSession(foundSession.id);
                } else {
                    alert('Aucune session trouv√©e avec ces crit√®res.');
                }
            }
        }

        function searchSessions() {
            const search = document.getElementById('search-session').value.toLowerCase();
            const grid = document.getElementById('sessions-grid');
            const cards = grid.querySelectorAll('.session-card');

            cards.forEach(card => {
                const title = card.querySelector('.session-card-title').textContent.toLowerCase();
                const code = card.querySelector('.session-card-code').textContent.toLowerCase();

                if (title.includes(search) || code.includes(search)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function cancelEdit() {
            document.getElementById('edit-form').style.display = 'none';
        }

        function resetChanges() {
            if (confirm('Annuler toutes les modifications ?')) {
                // Recharger les donn√©es originales
                const currentSessionId = 1; // √Ä remplacer par l'ID r√©el
                loadSession(currentSessionId);
            }
        }

        function saveChanges() {
            alert('Modifications sauvegard√©es avec succ√®s !');
            // Ici: Logique pour sauvegarder dans la base de donn√©es
        }

        function publishChanges() {
            if (confirm('Publier les modifications ? Tous les participants seront notifi√©s.')) {
                alert('Modifications publi√©es !');
                // Ici: Logique pour publier les changements
            }
        }

        function addParticipant() {
            const email = document.getElementById('new-participant').value;
            if (email && email.includes('@')) {
                alert(`Candidat ${email} ajout√© avec succ√®s !`);
                document.getElementById('new-participant').value = '';
            } else {
                alert('Veuillez entrer un email valide.');
            }
        }

        function removeParticipant(id) {
            if (confirm('Retirer ce candidat de la session ?')) {
                alert('Candidat retir√©.');
            }
        }

        function addQuestionToSession() {
            alert('Redirection vers l\'√©diteur de questions...');
            // Ici: Ouvrir un modal ou rediriger
        }

        function duplicateSession() {
            if (confirm('Dupliquer cette session ?')) {
                alert('Session dupliqu√©e ! Une nouvelle session a √©t√© cr√©√©e.');
            }
        }

        function exportSession() {
            alert('Exportation de la session...');
            // Ici: Logique d'export
        }

        function archiveSession() {
            if (confirm('Archiver cette session ? Elle ne sera plus accessible aux candidats.')) {
                alert('Session archiv√©e.');
            }
        }

        function deleteSession() {
            if (confirm('‚ö†Ô∏è Attention ! Cette action est irr√©versible.\n\nSupprimer d√©finitivement cette session ?')) {
                alert('Session supprim√©e.');
                cancelEdit();
                loadSessions();
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function () {
            loadSessions();
        });
    </script>
</body>

</html>